<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="minimum-scale=1.0, width=device-width" name="viewport"><meta name="description" content="Querying child relationships"><title>Subqueries - Query.apex</title><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Roboto+Mono"><link rel="stylesheet" href="/query-apex/vendor/galano/galano.css"><link rel="stylesheet" href="/query-apex/vendor/icon-12/icon-12.css"><link rel="stylesheet" href="/query-apex/vendor/icon-16/icon-16.css"><link rel="stylesheet" href="/query-apex/vendor/senna/senna.css"><link rel="stylesheet" href="/query-apex/vendor/codemirror/lib/codemirror.css"><link rel="stylesheet" href="/query-apex/vendor/codemirror/theme/dracula.css"><script src="/query-apex/js/bundles/shared.electric.js"></script><script src="/query-apex/vendor/senna/senna.js"></script><script src="/query-apex/vendor/codemirror/lib/codemirror.js"></script><script src="/query-apex/vendor/codemirror/mode/javascript/javascript.js"></script><script src="/query-apex/vendor/codemirror/mode/xml/xml.js"></script><script src="/query-apex/vendor/codemirror/mode/css/css.js"></script><link rel="stylesheet" href="/query-apex/styles/main.css"></head><body data-senna=""><div data-senna-surface="" id="wrapper"><div class="senna-loading-bar"></div><div id="pageComponent"><div class=""><main class="content"><div class="tutorial"><div class="sidebar-navigation"><nav class="sidebar"><nav class=""><ul class="sidebar-list"><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_1.html" data-time="90"><span class="before"></span><span class="tutorial-step">1</span><span class="section-title">Installation</span><span class="after"></span></a></li><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_2.html" data-time="90"><span class="before"></span><span class="tutorial-step">2</span><span class="section-title">Simple queries</span><span class="after"></span></a></li><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_3.html" data-time="90"><span class="before"></span><span class="tutorial-step">3</span><span class="section-title">Fields Selection</span><span class="after"></span></a></li><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_4.html" data-time="90"><span class="before"></span><span class="tutorial-step">4</span><span class="section-title">Fields Selection Continued</span><span class="after"></span></a></li><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_5.html" data-time="150"><span class="before"></span><span class="tutorial-step">5</span><span class="section-title">Conditions</span><span class="after"></span></a></li><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_6.html" data-time="90"><span class="before"></span><span class="tutorial-step">6</span><span class="section-title">Conditions Part 2</span><span class="after"></span></a></li><li class="sidebar-item"><a class="sidebar-link" href="/query-apex/tutorials/getting_started/step_7.html" data-time="180"><span class="before"></span><span class="tutorial-step">7</span><span class="section-title">Conditions Part 3</span><span class="after"></span></a></li><li class="sidebar-item active"><a class="sidebar-link sidebar-link-selected" href="/query-apex/tutorials/getting_started/step_8.html" data-time="120"><span class="before"></span><span class="tutorial-step">8</span><span class="section-title">Subqueries</span><span class="after"></span></a></li></ul></nav></nav></div><div class="sidebar-offset"><nav class="topbar topbar-light"><div class="topbar-logo"><a class="topbar-logo-link" href="/query-apex"><span class="topbar-logo-icon icon-16-hammer"></span><h3 class="topbar-logo-text">Query.apex</h3></a></div><nav class="topbar-menu"><button class="topbar-toggle">Menu</button><ul class="topbar-list"><li class="topbar-item"><a class="topbar-link " href="/query-apex/docs/" target="undefined"><span>Docs</span></a></li><li class="topbar-item"><a class="topbar-link topbar-link-selected" href="/query-apex/tutorials/getting_started/step_1.html" target="undefined"><span>Tutorials</span></a></li></ul></nav></nav><div class="container"><h6 class="tutorial-title">Getting started with Query.apex</h6><p class="tutorial-time-remaining"></p><div class="container-blog card"><h2>Subqueries</h2><p>In this section, we will see how a child relationship query, sometimes called subquery, can be constructed. But before that, let's review how a subquery works in Salesforce:</p><p>Take the objects Account and Contact as an example. Contact object has a lookup field (foreign key) pointing to a Contact, so Account is the parent of Contact, and in reverse Contact is the child of Account. We already saw that in previous sections, when querying the Contact object, it's also possible to get the fields in the parent object, which is Account object in this case. However, it would be slightly more complicated when trying to query a field from a child.</p><p>Here is an example of such a query in SOQL:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="text" ref="code">
SELECT Name, (SELECT FirstName, LastName FROM Contacts) FROM Account</code></pre></div><p>In this case, 'Contacts' is the child relationship name, and the query inside the parentheses is a subquery.</p><p>Let's see how to construct such a query using Query.apex:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">
List<account> accounts =
    new Query('Account').
    addSubquery(
        Query.subquery('Contacts').
        selectFields('FirstName, LastName')
    ).
    run();</account></code></pre></div><p>Similar to the condition, we need to construct a subquery using the static method 'subquery', which takes a child relationship name as a parameter, before calling the 'addSubquery' member method.</p><p>Here is another example of a subquery with conditions and limits:</p><div class="code-container"><button class="btn btn-sm btn-copy"><span class="icon-12-overlap"></span></button><pre><code class="code" data-mode="javascript" ref="code">
List<account> accounts =
    new Query('Account').
    addSubquery(
        Query.subquery('Contacts').
        addConditionEq('FirstName', 'Sam').
        addConditionIn('LastName', new List<string>{'Tarly'})
    ).
    run();</string></account></code></pre></div><p>As we can see, after constructing the subquery, we can still do field selection and add conditions using the same methods in Query. Using a combination of the methods above, we should be able to build a query with a subquery in any complexity.</p><input type="hidden" value="Subqueries"><input type="hidden" value="Query.apex"><div class="tutorial-page-nav"></div></div></div></div></div></main></div></div><script src="/query-apex/js/bundles/nzbkZ.js"></script><script>var data = '{"pageLocation":"index.children.tutorials.children.getting_started.children.step_8","site":{"title":"Query.apex","githubRepo":"Click-to-Cloud/Query.apex","googleAnalytics":"","index":{"title":"Home","description":"Query.apex provides a flexible and dynamic way of building a SOQL query on the Salesforce platform.","srcFilePath":"src/pages/index.soy","id":"pages","location":"/./","url":"/query-apex/./","children":{"docs":{"title":"Docs","description":"Everything you need to know to get started.","srcFilePath":"src/pages/docs/index.soy","id":"docs","location":"/docs/","url":"/query-apex/docs/","children":{"search":{"title":"Search","description":"Find what you\'re looking for in the documentation.","hidden":true,"srcFilePath":"src/pages/docs/search.soy","id":"search","location":"/docs/search.html","url":"/query-apex/docs/search.html"},"Query":{"children":{"condition":{"title":"Condition","description":"Condition methods in Query","layout":"guide","icon":"code-file","weight":4,"srcFilePath":"src/pages/docs/Query/condition.md","id":"condition","location":"/docs/Query/condition.html","url":"/query-apex/docs/Query/condition.html"},"constructors":{"title":"Constructor","description":"Constructors of Query","layout":"guide","icon":"code-file","weight":1,"srcFilePath":"src/pages/docs/Query/constructors.md","id":"constructors","location":"/docs/Query/constructors.html","url":"/query-apex/docs/Query/constructors.html"},"field":{"title":"Field Selection","description":"Field selection methods in Query","layout":"guide","icon":"code-file","weight":3,"srcFilePath":"src/pages/docs/Query/field.md","id":"field","location":"/docs/Query/field.html","url":"/query-apex/docs/Query/field.html"},"result":{"title":"Result","description":"Methods to get the Query result","layout":"guide","icon":"code-file","weight":2,"srcFilePath":"src/pages/docs/Query/result.md","id":"result","location":"/docs/Query/result.html","url":"/query-apex/docs/Query/result.html"},"subquery":{"title":"Subquery","description":"Subquery methods in Query","layout":"guide","icon":"code-file","weight":5,"srcFilePath":"src/pages/docs/Query/subquery.md","id":"subquery","location":"/docs/Query/subquery.html","url":"/query-apex/docs/Query/subquery.html"}},"title":"Query class","description":"Public methods in Query","layout":"guide","icon":"code-file","weight":1,"srcFilePath":"src/pages/docs/Query/index.md","id":"Query","location":"/docs/Query/","url":"/query-apex/docs/Query/","childIds":["constructors","result","field","condition","subquery"]}},"childIds":["Query","search"]},"tutorials":{"title":"Tutorials","description":"The tutorials","url":"/query-apex/tutorials/getting_started/step_1.html","layout":false,"srcFilePath":"src/pages/tutorials/index.soy","id":"tutorials","location":"/tutorials/","customURL":true,"children":{"getting_started":{"title":"Getting Started","description":"The Getting Started Tutorial","tutorialTitle":"Getting started with Query.apex","url":"/query-apex/tutorials/getting_started/step_1.html","layout":false,"srcFilePath":"src/pages/tutorials/getting_started/index.soy","id":"getting_started","location":"/tutorials/getting_started/","customURL":true,"children":{"step_1":{"title":"Installation","description":"Include Apex files","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":1,"srcFilePath":"src/pages/tutorials/getting_started/step_1.md","id":"step_1","location":"/tutorials/getting_started/step_1.html","url":"/query-apex/tutorials/getting_started/step_1.html"},"step_2":{"title":"Simple queries","description":"Some simple queries","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":2,"srcFilePath":"src/pages/tutorials/getting_started/step_2.md","id":"step_2","location":"/tutorials/getting_started/step_2.html","url":"/query-apex/tutorials/getting_started/step_2.html"},"step_3":{"title":"Fields Selection","description":"Select specific fields","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":3,"srcFilePath":"src/pages/tutorials/getting_started/step_3.md","id":"step_3","location":"/tutorials/getting_started/step_3.html","url":"/query-apex/tutorials/getting_started/step_3.html"},"step_4":{"title":"Fields Selection Continued","description":"Select parental fields","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":4,"srcFilePath":"src/pages/tutorials/getting_started/step_4.md","id":"step_4","location":"/tutorials/getting_started/step_4.html","url":"/query-apex/tutorials/getting_started/step_4.html"},"step_5":{"title":"Conditions","description":"Add one condition to the query","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":150,"weight":5,"srcFilePath":"src/pages/tutorials/getting_started/step_5.md","id":"step_5","location":"/tutorials/getting_started/step_5.html","url":"/query-apex/tutorials/getting_started/step_5.html"},"step_6":{"title":"Conditions Part 2","description":"Add multiple conditions","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":90,"weight":6,"srcFilePath":"src/pages/tutorials/getting_started/step_6.md","id":"step_6","location":"/tutorials/getting_started/step_6.html","url":"/query-apex/tutorials/getting_started/step_6.html"},"step_7":{"title":"Conditions Part 3","description":"Add more complex conditions","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":180,"weight":7,"srcFilePath":"src/pages/tutorials/getting_started/step_7.md","id":"step_7","location":"/tutorials/getting_started/step_7.html","url":"/query-apex/tutorials/getting_started/step_7.html"},"step_8":{"title":"Subqueries","description":"Querying child relationships","buttonTitle":"Done","parentId":"getting_started","layout":"tutorial","time":120,"weight":8,"srcFilePath":"src/pages/tutorials/getting_started/step_8.md","id":"step_8","location":"/tutorials/getting_started/step_8.html","url":"/query-apex/tutorials/getting_started/step_8.html","active":true}},"childIds":["step_1","step_2","step_3","step_4","step_5","step_6","step_7","step_8"],"active":true}},"childIds":["getting_started"],"active":true}},"childIds":["docs","tutorials"]},"basePath":"/query-apex","topbar":[{"href":"/query-apex/docs/","label":"Docs"},{"href":"/query-apex/tutorials/getting_started/step_1.html","label":"Tutorials","selected":true}]}}'; if (typeof electric !== 'undefined') {electric.init(data);}else {document.addEventListener('DOMContentLoaded', function() {electric.init(data);});}</script></div><script data-senna-track="permanent" src="/query-apex/js/electric/electric.js"></script></body></html>